# Bio-STARK

Bio-STARK is an extension of [STARK](https://github.com/quasylab/jspear) for the simulation and analysis of biological systems.
Specifically, to simulate the stochastic, dynamical, behaviour of these systems, Bio-STARK exploits the core simulation model of STARK, the evolution sequence model, and it extends it by refining the discrete step modelling into a **time point** modelling.

In (Bio-)STARK a system is described by the interface `SystemState`, that provides the methods used by the simulator and the model checker, and that is used to specify system configurations.
In Bio-STARK the interface is implemented by the class `TimedSystem` that differs from the `ControlledSystem` class of STARK in that: 
* We extend the `DataState` class with four special variables, `tp`, `te`, $\delta$`t`, `gr`, allowing us to manage time.
Specifically:
  * `tp` represents the _last time point that was reached_;
  * `te` represents the _total time elapsed_ since the beginning of the computation;
  * $\delta$`t` represents the _duration of the current computation step_;
  * `gr` represents the chosen _granularity_, i.e., the time interval between observations.
* We add a `DataStateExpression`, used to quantify $\delta$`t` for the current computation step.
  
When simulating each computation step, the $\delta$`t` is added to `te`, allowing us to keep track of the total time elapsed.
Variable `gr` is used to state how frequently we will observe the system.
Intuitively, the granularity is the time interval between time points at which we can observe the configuration of the system, and it disregards the number of computation steps that occur between two consecutive time points.
An evolution sequence is then the sequence of distributions that are reached at the time points.

The `TimedSystem` class is smoothly integrated in the back-end, in the sense that all other classes that are implemented in STARK (like those necessary to apply perturbations, or to evaluate distances and or formulae) remain unchanged in Bio-STARK, since they will automatically interact with the `EvolutionSequence` generated by the `TimedSystem`, i.e., only with the distributions reached at the time points.


Hence, Bio-STARK includes:

 * A randomised procedure that, based on simulation, permits the estimation of the evolution sequence of a system $s$, assuming an initial distribution $\mu$. We sample $N$ sequences of data states $d\_{(0,j)}$,...,$d\_{(k,j)}$, for $j=1,...,N$. All the data states collected at time $i$ are used to estimate the distribution $ES\_{(s,i)}$, i.e., the $i$-th distribution in the evolution sequence of $s$.  
 * A procedure that given an evolution sequence permits to sample the effects of a perturbation over it. The same approach used to obtain an estimation of the evolution sequence can be used to obtain its perturbation. The only difference is that while for evolution sequences the data state obtained at step $i+1$ only depends on the data state at step $i$, here the effect of a perturbation $p$ can be also applied. To guarantee statistical relevance of the collected data, for each sampled data state in the evolution sequence we use and additional number $M$ of samplings to estimate the effects of $p$ over it.
 * A mechanism to estimate the Wasserstein distance between two probability distributions over data states.
 * A function that permits evaluating a distance expression between an evolution sequence and its perturbed variant. A distance expression is evaluated, following a syntax driven procedure, by applying the estimation of the Wasserstein distance considered in the previous step at the involved time steps. 
 * A procedure that checks if a given evolution sequence satisfies a given formula.

Since the procedures outlined above are based on statistical inference, we need to take into account the statistical error when checking the satisfaction of formulae.
Hence, STARK also includes a classical algorithm for the evaluation of confidence intervals in the evaluation of distances, and a three-valued semantics for RobTL specifications, in which the truth value *unknown* is added to true and false.

The [lib](https://github.com/stark-tool/Bio-STARK/tree/Tony/lib) folder contains all the [JAVA classes](https://github.com/stark-tool/Bio-STARK/tree/Tony/lib/src/main/java/it/unicam/quasylab/jspear) that are necessary to implement all the procedures, mechanisms, and functions described above.

In the [examples](https://github.com/stark-tool/Bio-STARK/tree/Tony/examples) folder you can find the folders [isocitrate](https://github.com/stark-tool/Bio-STARK/tree/Tony/examples/Isocitrate/src/main/java/it/unicam/quasylab/jspear/examples/Isocitrate) and [repressilator](https://github.com/stark-tool/Bio-STARK/tree/Tony/examples/repressilator/src/main/java/it/unicam/quasylab/jspear/examples/repressilator) with the scripts that showcase different features of Bio-STARK over two case studies from system biology. 


## Download 

To download Bio-STARK you have to clone the GitHub project (branch _Tony_):

```
git clone --branch Tony https://github.com/stark-tool/Bio-STARK.git 
```

Run this command in the folder where you want to download the tool.

## How to run experiments with Java

You will need
* A text editor or IDE (we used [IntelliJ IDEA](https://www.jetbrains.com/idea/))
* A JAVA Development Kit (JDK). We used version 18. To ensure compatibility with Gradle, please use any version between 8 and 18.
* A [Gradle](https://docs.gradle.org/current/userguide/userguide.html) distribution. We used version 7.4.2.

Firstly, you need to review the files in the project directory by executing:
```
settings.gradle
```
Then, you simply need to run the Main.java file in the folder of the case study you want to analyse:
```
java Main
```
To obtain the plots through the CSV files generated by the Java scripts, Python3 (>= 3.9) is needed. 
Moreover, the following Python packages must be available:

    numpy >= 1.18.4
    scipy >= 1.4.1
    matplotlib >= 3.0.3

